<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8" />
    <title></title>
    <link href="/js/normalize.css" rel="stylesheet" type="text/css" />
    <link href="/js/jquery-ui.css" rel="stylesheet" type="text/css" />
    <link href="/js/jtable.2.4.0/themes/metro/blue/jtable.min.css" rel="stylesheet" type="text/css" /> 
    <link href="https://code.jquery.com/ui/1.10.0/jquery-ui.min.css" rel="stylesheet" type="text/css" /> 

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.10.0/jquery-ui.min.js" type="text/javascript"></script>
    <script src="/js/jtable.2.4.0/jquery.jtable.min.js" type="text/javascript"></script>
</head>
<body>
<input type="hidden" id="projectId" th:value="${project.getId()}" />
<input type="hidden" id="userId" th:value="${userSessionInfo.getId()}" />

<h1>Manage tasks for project <span th:text="${project.getProjectname()}"></span></h1>
<div id="JTableContainer" style="width: 1024px;"></div>
<script type="text/javascript">
    var processClick = function(event, data) {
        $('.jtable-data-row').off('click').on('click', (function() {
            var row_id = $(this).attr('data-record-key');
            alert('clicked row with id '+row_id);
        }));
    }

    $(document).ready(function () {
        //Prepare jTable
        $('#JTableContainer').jtable({
                    title: 'Waterfall Tasks',
                    defaultSorting: 'id DESC',
                    sorting: true,
                    actions: {
                        listAction: '/cmpe281project/api/WF/listTasks?projectId=' + $('#projectId').val(),
                        createAction: '/cmpe281project/api/WF/createTask?projectId=' + $('#projectId').val(),
                        updateAction: '/cmpe281project/api/WF/updateTask?projectId=' + $('#projectId').val(),
                        deleteAction: '/cmpe281project/api/WF/deleteTask?projectId=' + $('#projectId').val()
                    },
                    fields: {
                        id: {
                            title: 'TaskId',
                            key: true,
                            list: true
                        },
                        status: {
                            title: 'Status',
                            options: {'1': 'Ready', '2': 'Inprogress', '3': 'Completed'},
                            width: '10%'
                        },
                        taskName: {
                            title: 'Name',
                            width: '10%',
                            sorting: true
                        },
                        taskDescription: {
                            title: 'Description',
                            width: '10%'
                        },
                        resourceName: {
                            title: 'Resource Name',
                            width: '10%'
                        },
                        startDate: {
                            title: 'Start Date',
                            width: '30%',
                            type: 'date',
                            displayFormat: 'mm/dd/yy'
                        },
                        endDate: {
                            title: 'End Date',
                            width: '30%',
                            type: 'date',
                            displayFormat: 'mm/dd/yy'
                        }
                    },
                    recordsLoaded: processClick,
                    rowInserted: processClick
                }
        );

        $('#JTableContainer').jtable('load');
    });

</script>

</body>
</html>